import { FC } from 'react';

import AuthorsNotes from 'components/authors_notes';
import { Monospace } from 'components/copy';
import InfoIcon from 'components/info_icon';
import { PuzzleDataProps, getPuzzleProps } from 'components/puzzle';
import SheetableImage from 'components/sheetable_image';
import Solution, { Answerize, Clue } from 'components/solution';
import Table from 'components/table';

import image0 from 'assets/solutions/marathon-block-pushing-game/0.gif';
import image1 from 'assets/solutions/marathon-block-pushing-game/1.png';
import image2 from 'assets/solutions/marathon-block-pushing-game/2.png';
import image3 from 'assets/solutions/marathon-block-pushing-game/3.png';
import image4 from 'assets/solutions/marathon-block-pushing-game/4.png';
import image5 from 'assets/solutions/marathon-block-pushing-game/5.png';
import image6 from 'assets/solutions/marathon-block-pushing-game/6.png';
import image7 from 'assets/solutions/marathon-block-pushing-game/7.gif';
import image8 from 'assets/solutions/marathon-block-pushing-game/8.png';

const SLUG = 'marathon-block-pushing-game';
const ANSWER = `I SEE DEAD PEOPLE`;

const PuzzleSolution: FC<PuzzleDataProps> = ({ puzzleData }) => (
  <Solution puzzleData={puzzleData} answer={ANSWER}>
    <p>
      We are given a block-pushing game written in PuzzleScript. The rules are
      identical to Sokoban, the aim of which is to cover every target square
      with a box. The game starts off in a simple room, then it puts us into a
      huge maze. Here is the solution to the simple room in the minimum number
      of steps.
    </p>
    <p>
      <SheetableImage alt="" src={image0} title="" className="mx-auto" />
    </p>
    <p>
      On the menu screen, we see a "hack" link at the bottom, which takes us to
      the source code of the game. The comment{' '}
      <i>(Welcome hunters! Feel free to examine the code)</i> indicates that the
      code is also part of the puzzle. Here we can see the entire maze, the
      winning message, and a "debug" comment at the bottom of the code. The
      winning message "
      <i>
        Congra- wait, you cheated, didn't you? That's understandable - it would
        have taken you several hundred moves if you didn't.
      </i>
      " suggests that we want to analyze the number of moves required to solve
      the Sokoban.{' '}
    </p>
    <p>
      The hardest target in the game is the target near the top left corner
      (which you can see in the starting screen, on the bottom left corner). The
      box that has to go there is in the bottom left corner. However, getting
      behind that box to push it is difficult, and requires going through the
      whole maze. The huge maze is made of copies of the following room, with
      two different versions we will call <Monospace>State 0</Monospace> and{' '}
      <Monospace>State 1</Monospace>.
    </p>
    <p>
      <SheetableImage alt="" src={image1} title="" className="mx-auto" />
    </p>
    <p>
      <Monospace>State 0</Monospace>
    </p>
    <p>
      <SheetableImage alt="" src={image2} title="" className="mx-auto" />
    </p>
    <p>
      <Monospace>State 1</Monospace>
    </p>
    <p>
      Each of these rooms has an entrance A and two exits B and C. B leads all
      the way back to the beginning, while C leads to the next room. These rooms
      form a chain of 78 rooms, with the aim going to the end of the chain. We
      see that each of these rooms has several similar subrooms, which act as
      one-way gates.
    </p>
    <p>
      <SheetableImage alt="" src={image3} title="" className="mx-auto" />
    </p>
    <p>
      From <Monospace>State 0</Monospace>, it is impossible to reach exit C
      without ending up in an unsolvable state. The only way to make progress is
      to go down, push the top right box one step to the right, then exit via
      exit B.
    </p>
    <p>
      <SheetableImage alt="" src={image4} title="" className="mx-auto" />
    </p>
    <p>
      This results in transforming the room into <Monospace>State 1</Monospace>{' '}
      and exiting via exit B. From <Monospace>State 1</Monospace>, we can reach
      exit C, but at the cost of transforming the room back into{' '}
      <Monospace>State 0</Monospace>.
    </p>
    <p>
      <SheetableImage alt="" src={image5} title="" className="mx-auto" />
    </p>
    <p>
      Hence, from <Monospace>State 0</Monospace>, in order to reach exit C, we
      need to reach entrance A twice. Therefore, the total number of required
      moves will grow exponentially in the length of the chain. At the high
      level, these rooms mimic a binary counter, and each pass of the player is
      only able to increase that counter by 1.
    </p>
    <p>
      To compute the total number of moves, we can break up the maze into
      several paths, and compute the number of times each path must be traversed
      recursively. For example, in <Monospace>State 0</Monospace>, suppose we
      require to reach exit C n times. Then we would need to take the path AC n
      times, and the path AB n times, and thus reach entrance A 2n times. If we
      were in <Monospace>State 1</Monospace> instead, then path AB would be
      taken n-1 times, and entrance A 2n-1 times. We can tabulate each path, its
      length and the number of times traversed. Some points of the maze are
      labelled, and we describe a path by the pair of labelled points.
    </p>
    <InfoIcon>Click to open in a new tab.</InfoIcon>
    <p>
      <a href={image6} target="_blank">
        <SheetableImage alt="" src={image6} title="" />
      </a>
    </p>
    <Table>
      <thead>
        <tr>
          <th>Path</th>
          <th>Room initial state</th>
          <th>Length</th>
          <th>#Traversals</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>start-A0</td>
          <td>-</td>
          <td>68</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A78-end</td>
          <td>-</td>
          <td>102</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A77-A78</td>
          <td>1</td>
          <td>29</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A77-B78</td>
          <td>1</td>
          <td>75</td>
          <td>0</td>
        </tr>
        <tr>
          <td>B78-A0</td>
          <td>-</td>
          <td>134</td>
          <td>0</td>
        </tr>
        <tr>
          <td>A76-A77</td>
          <td>1</td>
          <td>29</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A76-B77</td>
          <td>1</td>
          <td>75</td>
          <td>0</td>
        </tr>
        <tr>
          <td>B77-A0</td>
          <td>-</td>
          <td>145</td>
          <td>0</td>
        </tr>
        <tr>
          <td>A75-A76</td>
          <td>1</td>
          <td>29</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A75-B76</td>
          <td>1</td>
          <td>75</td>
          <td>0</td>
        </tr>
        <tr>
          <td>B76-A0</td>
          <td>-</td>
          <td>156</td>
          <td>0</td>
        </tr>
        <tr>
          <td>A74-A75</td>
          <td>1</td>
          <td>29</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A74-B75</td>
          <td>1</td>
          <td>75</td>
          <td>0</td>
        </tr>
        <tr>
          <td>B75-A0</td>
          <td>-</td>
          <td>167</td>
          <td>0</td>
        </tr>
        <tr>
          <td>A73-A74</td>
          <td>0</td>
          <td>29</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A73-B74</td>
          <td>0</td>
          <td>75</td>
          <td>1</td>
        </tr>
        <tr>
          <td>B74-A0</td>
          <td>-</td>
          <td>178</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A72-A73</td>
          <td>1</td>
          <td>29</td>
          <td>2</td>
        </tr>
        <tr>
          <td>A72-B73</td>
          <td>1</td>
          <td>75</td>
          <td>1</td>
        </tr>
        <tr>
          <td>B73-A0</td>
          <td>-</td>
          <td>189</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A71-A72</td>
          <td>0</td>
          <td>29</td>
          <td>3</td>
        </tr>
        <tr>
          <td>A71-B72</td>
          <td>0</td>
          <td>75</td>
          <td>3</td>
        </tr>
        <tr>
          <td>B72-A0</td>
          <td>-</td>
          <td>200</td>
          <td>3</td>
        </tr>
        <tr>
          <td>A70-A71</td>
          <td>1</td>
          <td>29</td>
          <td>6</td>
        </tr>
        <tr>
          <td>A70-B71</td>
          <td>1</td>
          <td>75</td>
          <td>5</td>
        </tr>
        <tr>
          <td>B71-A0</td>
          <td>-</td>
          <td>211</td>
          <td>5</td>
        </tr>
        <tr>
          <td>A69-A70</td>
          <td>1</td>
          <td>29</td>
          <td>11</td>
        </tr>
        <tr>
          <td>A69-B70</td>
          <td>1</td>
          <td>75</td>
          <td>10</td>
        </tr>
        <tr>
          <td>B70-A0</td>
          <td>-</td>
          <td>222</td>
          <td>10</td>
        </tr>
        <tr>
          <td>A68'-A69</td>
          <td>0</td>
          <td>29</td>
          <td>21</td>
        </tr>
        <tr>
          <td>A68'-B69</td>
          <td>0</td>
          <td>75</td>
          <td>21</td>
        </tr>
        <tr>
          <td>B69-A0</td>
          <td>-</td>
          <td>233</td>
          <td>21</td>
        </tr>
        <tr>
          <td>A68-A68'</td>
          <td>-</td>
          <td>28</td>
          <td>42</td>
        </tr>
        <tr>
          <td>A67-A68</td>
          <td>0</td>
          <td>29</td>
          <td>42</td>
        </tr>
        <tr>
          <td>A67-B68</td>
          <td>0</td>
          <td>75</td>
          <td>42</td>
        </tr>
        <tr>
          <td>B68-A0</td>
          <td>-</td>
          <td>226</td>
          <td>42</td>
        </tr>
        <tr>
          <td>A66-A67</td>
          <td>1</td>
          <td>29</td>
          <td>84</td>
        </tr>
        <tr>
          <td>A66-B67</td>
          <td>1</td>
          <td>75</td>
          <td>83</td>
        </tr>
        <tr>
          <td>B67-A0</td>
          <td>-</td>
          <td>215</td>
          <td>83</td>
        </tr>
        <tr>
          <td>A65-A66</td>
          <td>1</td>
          <td>29</td>
          <td>167</td>
        </tr>
        <tr>
          <td>A65-B66</td>
          <td>1</td>
          <td>75</td>
          <td>166</td>
        </tr>
        <tr>
          <td>B66-A0</td>
          <td>-</td>
          <td>204</td>
          <td>166</td>
        </tr>
        <tr>
          <td>A64-A65</td>
          <td>0</td>
          <td>29</td>
          <td>333</td>
        </tr>
        <tr>
          <td>A64-B65</td>
          <td>0</td>
          <td>75</td>
          <td>333</td>
        </tr>
        <tr>
          <td>B65-A0</td>
          <td>-</td>
          <td>193</td>
          <td>333</td>
        </tr>
        <tr>
          <td>A63-A64</td>
          <td>0</td>
          <td>29</td>
          <td>666</td>
        </tr>
        <tr>
          <td>A63-B64</td>
          <td>0</td>
          <td>75</td>
          <td>666</td>
        </tr>
        <tr>
          <td>B64-A0</td>
          <td>-</td>
          <td>182</td>
          <td>666</td>
        </tr>
        <tr>
          <td>A62-A63</td>
          <td>0</td>
          <td>29</td>
          <td>1332</td>
        </tr>
        <tr>
          <td>A62-B63</td>
          <td>0</td>
          <td>75</td>
          <td>1332</td>
        </tr>
        <tr>
          <td>B63-A0</td>
          <td>-</td>
          <td>171</td>
          <td>1332</td>
        </tr>
        <tr>
          <td>A61-A62</td>
          <td>1</td>
          <td>29</td>
          <td>2664</td>
        </tr>
        <tr>
          <td>A61-B62</td>
          <td>1</td>
          <td>75</td>
          <td>2663</td>
        </tr>
        <tr>
          <td>B62-A0</td>
          <td>-</td>
          <td>160</td>
          <td>2663</td>
        </tr>
        <tr>
          <td>A60-A61</td>
          <td>0</td>
          <td>29</td>
          <td>5327</td>
        </tr>
        <tr>
          <td>A60-B61</td>
          <td>0</td>
          <td>75</td>
          <td>5327</td>
        </tr>
        <tr>
          <td>B61-A0</td>
          <td>-</td>
          <td>149</td>
          <td>5327</td>
        </tr>
        <tr>
          <td>A59-A60</td>
          <td>1</td>
          <td>29</td>
          <td>10654</td>
        </tr>
        <tr>
          <td>A59-B60</td>
          <td>1</td>
          <td>75</td>
          <td>10653</td>
        </tr>
        <tr>
          <td>B60-A0</td>
          <td>-</td>
          <td>138</td>
          <td>10653</td>
        </tr>
        <tr>
          <td>A58-A59</td>
          <td>1</td>
          <td>29</td>
          <td>21307</td>
        </tr>
        <tr>
          <td>A58-B59</td>
          <td>1</td>
          <td>75</td>
          <td>21306</td>
        </tr>
        <tr>
          <td>B59-A0</td>
          <td>-</td>
          <td>127</td>
          <td>21306</td>
        </tr>
        <tr>
          <td>A57-A58</td>
          <td>0</td>
          <td>29</td>
          <td>42613</td>
        </tr>
        <tr>
          <td>A57-B58</td>
          <td>0</td>
          <td>75</td>
          <td>42613</td>
        </tr>
        <tr>
          <td>B58-A0</td>
          <td>-</td>
          <td>106</td>
          <td>42613</td>
        </tr>
        <tr>
          <td>A56-A57</td>
          <td>0</td>
          <td>29</td>
          <td>85226</td>
        </tr>
        <tr>
          <td>A56-B57</td>
          <td>0</td>
          <td>75</td>
          <td>85226</td>
        </tr>
        <tr>
          <td>B57-A0</td>
          <td>-</td>
          <td>117</td>
          <td>85226</td>
        </tr>
        <tr>
          <td>A55-A56</td>
          <td>1</td>
          <td>29</td>
          <td>170452</td>
        </tr>
        <tr>
          <td>A55-B56</td>
          <td>1</td>
          <td>75</td>
          <td>170451</td>
        </tr>
        <tr>
          <td>B56-A0</td>
          <td>-</td>
          <td>128</td>
          <td>170451</td>
        </tr>
        <tr>
          <td>A54-A55</td>
          <td>1</td>
          <td>29</td>
          <td>340903</td>
        </tr>
        <tr>
          <td>A54-B55</td>
          <td>1</td>
          <td>75</td>
          <td>340902</td>
        </tr>
        <tr>
          <td>B55-A0</td>
          <td>-</td>
          <td>139</td>
          <td>340902</td>
        </tr>
        <tr>
          <td>A53-A54</td>
          <td>1</td>
          <td>29</td>
          <td>681805</td>
        </tr>
        <tr>
          <td>A53-B54</td>
          <td>1</td>
          <td>75</td>
          <td>681804</td>
        </tr>
        <tr>
          <td>B54-A0</td>
          <td>-</td>
          <td>150</td>
          <td>681804</td>
        </tr>
        <tr>
          <td>A52-A53</td>
          <td>0</td>
          <td>29</td>
          <td>1363609</td>
        </tr>
        <tr>
          <td>A52-B53</td>
          <td>0</td>
          <td>75</td>
          <td>1363609</td>
        </tr>
        <tr>
          <td>B53-A0</td>
          <td>-</td>
          <td>161</td>
          <td>1363609</td>
        </tr>
        <tr>
          <td>A51-A52</td>
          <td>0</td>
          <td>29</td>
          <td>2727218</td>
        </tr>
        <tr>
          <td>A51-B52</td>
          <td>0</td>
          <td>75</td>
          <td>2727218</td>
        </tr>
        <tr>
          <td>B52-A0</td>
          <td>-</td>
          <td>172</td>
          <td>2727218</td>
        </tr>
        <tr>
          <td>A50-A51</td>
          <td>0</td>
          <td>29</td>
          <td>5454436</td>
        </tr>
        <tr>
          <td>A50-B51</td>
          <td>0</td>
          <td>75</td>
          <td>5454436</td>
        </tr>
        <tr>
          <td>B51-A0</td>
          <td>-</td>
          <td>183</td>
          <td>5454436</td>
        </tr>
        <tr>
          <td>A49-A50</td>
          <td>0</td>
          <td>29</td>
          <td>10908872</td>
        </tr>
        <tr>
          <td>A49-B50</td>
          <td>0</td>
          <td>75</td>
          <td>10908872</td>
        </tr>
        <tr>
          <td>B50-A0</td>
          <td>-</td>
          <td>194</td>
          <td>10908872</td>
        </tr>
        <tr>
          <td>A48'-A49</td>
          <td>1</td>
          <td>29</td>
          <td>21817744</td>
        </tr>
        <tr>
          <td>A48'-B49</td>
          <td>1</td>
          <td>75</td>
          <td>21817743</td>
        </tr>
        <tr>
          <td>B49-A0</td>
          <td>-</td>
          <td>205</td>
          <td>21817743</td>
        </tr>
        <tr>
          <td>A48-A48'</td>
          <td>-</td>
          <td>28</td>
          <td>43635487</td>
        </tr>
        <tr>
          <td>A47-A48</td>
          <td>1</td>
          <td>29</td>
          <td>43635487</td>
        </tr>
        <tr>
          <td>A47-B48</td>
          <td>1</td>
          <td>75</td>
          <td>43635486</td>
        </tr>
        <tr>
          <td>B48-A0</td>
          <td>-</td>
          <td>198</td>
          <td>43635486</td>
        </tr>
        <tr>
          <td>A46-A47</td>
          <td>0</td>
          <td>29</td>
          <td>87270973</td>
        </tr>
        <tr>
          <td>A46-B47</td>
          <td>0</td>
          <td>75</td>
          <td>87270973</td>
        </tr>
        <tr>
          <td>B47-A0</td>
          <td>-</td>
          <td>187</td>
          <td>87270973</td>
        </tr>
        <tr>
          <td>A45-A46</td>
          <td>0</td>
          <td>29</td>
          <td>174541946</td>
        </tr>
        <tr>
          <td>A45-B46</td>
          <td>0</td>
          <td>75</td>
          <td>174541946</td>
        </tr>
        <tr>
          <td>B46-A0</td>
          <td>-</td>
          <td>176</td>
          <td>174541946</td>
        </tr>
        <tr>
          <td>A44-A45</td>
          <td>0</td>
          <td>29</td>
          <td>349083892</td>
        </tr>
        <tr>
          <td>A44-B45</td>
          <td>0</td>
          <td>75</td>
          <td>349083892</td>
        </tr>
        <tr>
          <td>B45-A0</td>
          <td>-</td>
          <td>165</td>
          <td>349083892</td>
        </tr>
        <tr>
          <td>A43-A44</td>
          <td>1</td>
          <td>29</td>
          <td>698167784</td>
        </tr>
        <tr>
          <td>A43-B44</td>
          <td>1</td>
          <td>75</td>
          <td>698167783</td>
        </tr>
        <tr>
          <td>B44-A0</td>
          <td>-</td>
          <td>154</td>
          <td>698167783</td>
        </tr>
        <tr>
          <td>A42-A43</td>
          <td>0</td>
          <td>29</td>
          <td>1396335567</td>
        </tr>
        <tr>
          <td>A42-B43</td>
          <td>0</td>
          <td>75</td>
          <td>1396335567</td>
        </tr>
        <tr>
          <td>B43-A0</td>
          <td>-</td>
          <td>143</td>
          <td>1396335567</td>
        </tr>
        <tr>
          <td>A41-A42</td>
          <td>1</td>
          <td>29</td>
          <td>2792671134</td>
        </tr>
        <tr>
          <td>A41-B42</td>
          <td>1</td>
          <td>75</td>
          <td>2792671133</td>
        </tr>
        <tr>
          <td>B42-A0</td>
          <td>-</td>
          <td>132</td>
          <td>2792671133</td>
        </tr>
        <tr>
          <td>A40-A41</td>
          <td>0</td>
          <td>29</td>
          <td>5585342267</td>
        </tr>
        <tr>
          <td>A40-B41</td>
          <td>0</td>
          <td>75</td>
          <td>5585342267</td>
        </tr>
        <tr>
          <td>B41-A0</td>
          <td>-</td>
          <td>121</td>
          <td>5585342267</td>
        </tr>
        <tr>
          <td>A39-A40</td>
          <td>0</td>
          <td>29</td>
          <td>11170684534</td>
        </tr>
        <tr>
          <td>A39-B40</td>
          <td>0</td>
          <td>75</td>
          <td>11170684534</td>
        </tr>
        <tr>
          <td>B40-A0</td>
          <td>-</td>
          <td>110</td>
          <td>11170684534</td>
        </tr>
        <tr>
          <td>A38-A39</td>
          <td>1</td>
          <td>29</td>
          <td>22341369068</td>
        </tr>
        <tr>
          <td>A38-B39</td>
          <td>1</td>
          <td>75</td>
          <td>22341369067</td>
        </tr>
        <tr>
          <td>B39-A0</td>
          <td>-</td>
          <td>99</td>
          <td>22341369067</td>
        </tr>
        <tr>
          <td>A37-A38</td>
          <td>0</td>
          <td>29</td>
          <td>44682738135</td>
        </tr>
        <tr>
          <td>A37-B38</td>
          <td>0</td>
          <td>75</td>
          <td>44682738135</td>
        </tr>
        <tr>
          <td>B38-A0</td>
          <td>-</td>
          <td>78</td>
          <td>44682738135</td>
        </tr>
        <tr>
          <td>A36-A37</td>
          <td>1</td>
          <td>29</td>
          <td>89365476270</td>
        </tr>
        <tr>
          <td>A36-B37</td>
          <td>1</td>
          <td>75</td>
          <td>89365476269</td>
        </tr>
        <tr>
          <td>B37-A0</td>
          <td>-</td>
          <td>89</td>
          <td>89365476269</td>
        </tr>
        <tr>
          <td>A35-A36</td>
          <td>0</td>
          <td>29</td>
          <td>178730952539</td>
        </tr>
        <tr>
          <td>A35-B36</td>
          <td>0</td>
          <td>75</td>
          <td>178730952539</td>
        </tr>
        <tr>
          <td>B36-A0</td>
          <td>-</td>
          <td>100</td>
          <td>178730952539</td>
        </tr>
        <tr>
          <td>A34-A35</td>
          <td>1</td>
          <td>29</td>
          <td>357461905078</td>
        </tr>
        <tr>
          <td>A34-B35</td>
          <td>1</td>
          <td>75</td>
          <td>357461905077</td>
        </tr>
        <tr>
          <td>B35-A0</td>
          <td>-</td>
          <td>111</td>
          <td>357461905077</td>
        </tr>
        <tr>
          <td>A33-A34</td>
          <td>1</td>
          <td>29</td>
          <td>714923810155</td>
        </tr>
        <tr>
          <td>A33-B34</td>
          <td>1</td>
          <td>75</td>
          <td>714923810154</td>
        </tr>
        <tr>
          <td>B34-A0</td>
          <td>-</td>
          <td>122</td>
          <td>714923810154</td>
        </tr>
        <tr>
          <td>A32-A33</td>
          <td>0</td>
          <td>29</td>
          <td>1429847620309</td>
        </tr>
        <tr>
          <td>A32-B33</td>
          <td>0</td>
          <td>75</td>
          <td>1429847620309</td>
        </tr>
        <tr>
          <td>B33-A0</td>
          <td>-</td>
          <td>133</td>
          <td>1429847620309</td>
        </tr>
        <tr>
          <td>A31-A32</td>
          <td>0</td>
          <td>29</td>
          <td>2859695240618</td>
        </tr>
        <tr>
          <td>A31-B32</td>
          <td>0</td>
          <td>75</td>
          <td>2859695240618</td>
        </tr>
        <tr>
          <td>B32-A0</td>
          <td>-</td>
          <td>144</td>
          <td>2859695240618</td>
        </tr>
        <tr>
          <td>A30-A31</td>
          <td>1</td>
          <td>29</td>
          <td>5719390481236</td>
        </tr>
        <tr>
          <td>A30-B31</td>
          <td>1</td>
          <td>75</td>
          <td>5719390481235</td>
        </tr>
        <tr>
          <td>B31-A0</td>
          <td>-</td>
          <td>155</td>
          <td>5719390481235</td>
        </tr>
        <tr>
          <td>A29-A30</td>
          <td>0</td>
          <td>29</td>
          <td>11438780962471</td>
        </tr>
        <tr>
          <td>A29-B30</td>
          <td>0</td>
          <td>75</td>
          <td>11438780962471</td>
        </tr>
        <tr>
          <td>B30-A0</td>
          <td>-</td>
          <td>166</td>
          <td>11438780962471</td>
        </tr>
        <tr>
          <td>A28'-A29</td>
          <td>0</td>
          <td>29</td>
          <td>22877561924942</td>
        </tr>
        <tr>
          <td>A28'-B29</td>
          <td>0</td>
          <td>75</td>
          <td>22877561924942</td>
        </tr>
        <tr>
          <td>B29-A0</td>
          <td>-</td>
          <td>177</td>
          <td>22877561924942</td>
        </tr>
        <tr>
          <td>A28-A28'</td>
          <td>-</td>
          <td>28</td>
          <td>45755123849884</td>
        </tr>
        <tr>
          <td>A27-A28</td>
          <td>1</td>
          <td>29</td>
          <td>45755123849884</td>
        </tr>
        <tr>
          <td>A27-B28</td>
          <td>1</td>
          <td>75</td>
          <td>45755123849883</td>
        </tr>
        <tr>
          <td>B28-A0</td>
          <td>-</td>
          <td>170</td>
          <td>45755123849883</td>
        </tr>
        <tr>
          <td>A26-A27</td>
          <td>1</td>
          <td>29</td>
          <td>91510247699767</td>
        </tr>
        <tr>
          <td>A26-B27</td>
          <td>1</td>
          <td>75</td>
          <td>91510247699766</td>
        </tr>
        <tr>
          <td>B27-A0</td>
          <td>-</td>
          <td>159</td>
          <td>91510247699766</td>
        </tr>
        <tr>
          <td>A25-A26</td>
          <td>1</td>
          <td>29</td>
          <td>183020495399533</td>
        </tr>
        <tr>
          <td>A25-B26</td>
          <td>1</td>
          <td>75</td>
          <td>183020495399532</td>
        </tr>
        <tr>
          <td>B26-A0</td>
          <td>-</td>
          <td>148</td>
          <td>183020495399532</td>
        </tr>
        <tr>
          <td>A24-A25</td>
          <td>1</td>
          <td>29</td>
          <td>366040990799065</td>
        </tr>
        <tr>
          <td>A24-B25</td>
          <td>1</td>
          <td>75</td>
          <td>366040990799064</td>
        </tr>
        <tr>
          <td>B25-A0</td>
          <td>-</td>
          <td>137</td>
          <td>366040990799064</td>
        </tr>
        <tr>
          <td>A23-A24</td>
          <td>1</td>
          <td>29</td>
          <td>732081981598129</td>
        </tr>
        <tr>
          <td>A23-B24</td>
          <td>1</td>
          <td>75</td>
          <td>732081981598128</td>
        </tr>
        <tr>
          <td>B24-A0</td>
          <td>-</td>
          <td>126</td>
          <td>732081981598128</td>
        </tr>
        <tr>
          <td>A22-A23</td>
          <td>1</td>
          <td>29</td>
          <td>1464163963196257</td>
        </tr>
        <tr>
          <td>A22-B23</td>
          <td>1</td>
          <td>75</td>
          <td>1464163963196256</td>
        </tr>
        <tr>
          <td>B23-A0</td>
          <td>-</td>
          <td>115</td>
          <td>1464163963196256</td>
        </tr>
        <tr>
          <td>A21-A22</td>
          <td>0</td>
          <td>29</td>
          <td>2928327926392513</td>
        </tr>
        <tr>
          <td>A21-B22</td>
          <td>0</td>
          <td>75</td>
          <td>2928327926392513</td>
        </tr>
        <tr>
          <td>B22-A0</td>
          <td>-</td>
          <td>104</td>
          <td>2928327926392513</td>
        </tr>
        <tr>
          <td>A20-A21</td>
          <td>1</td>
          <td>29</td>
          <td>5856655852785026</td>
        </tr>
        <tr>
          <td>A20-B21</td>
          <td>1</td>
          <td>75</td>
          <td>5856655852785025</td>
        </tr>
        <tr>
          <td>B21-A0</td>
          <td>-</td>
          <td>93</td>
          <td>5856655852785025</td>
        </tr>
        <tr>
          <td>A19-A20</td>
          <td>0</td>
          <td>29</td>
          <td>11713311705570051</td>
        </tr>
        <tr>
          <td>A19-B20</td>
          <td>0</td>
          <td>75</td>
          <td>11713311705570051</td>
        </tr>
        <tr>
          <td>B20-A0</td>
          <td>-</td>
          <td>82</td>
          <td>11713311705570051</td>
        </tr>
        <tr>
          <td>A18-A19</td>
          <td>1</td>
          <td>29</td>
          <td>23426623411140102</td>
        </tr>
        <tr>
          <td>A18-B19</td>
          <td>1</td>
          <td>75</td>
          <td>23426623411140101</td>
        </tr>
        <tr>
          <td>B19-A0</td>
          <td>-</td>
          <td>71</td>
          <td>23426623411140101</td>
        </tr>
        <tr>
          <td>A17-A18</td>
          <td>0</td>
          <td>29</td>
          <td>46853246822280203</td>
        </tr>
        <tr>
          <td>A17-B18</td>
          <td>0</td>
          <td>75</td>
          <td>46853246822280203</td>
        </tr>
        <tr>
          <td>B18-A0</td>
          <td>-</td>
          <td>50</td>
          <td>46853246822280203</td>
        </tr>
        <tr>
          <td>A16-A17</td>
          <td>1</td>
          <td>29</td>
          <td>93706493644560406</td>
        </tr>
        <tr>
          <td>A16-B17</td>
          <td>1</td>
          <td>75</td>
          <td>93706493644560405</td>
        </tr>
        <tr>
          <td>B17-A0</td>
          <td>-</td>
          <td>61</td>
          <td>93706493644560405</td>
        </tr>
        <tr>
          <td>A15-A16</td>
          <td>0</td>
          <td>29</td>
          <td>187412987289120811</td>
        </tr>
        <tr>
          <td>A15-B16</td>
          <td>0</td>
          <td>75</td>
          <td>187412987289120811</td>
        </tr>
        <tr>
          <td>B16-A0</td>
          <td>-</td>
          <td>72</td>
          <td>187412987289120811</td>
        </tr>
        <tr>
          <td>A14-A15</td>
          <td>0</td>
          <td>29</td>
          <td>374825974578241622</td>
        </tr>
        <tr>
          <td>A14-B15</td>
          <td>0</td>
          <td>75</td>
          <td>374825974578241622</td>
        </tr>
        <tr>
          <td>B15-A0</td>
          <td>-</td>
          <td>83</td>
          <td>374825974578241622</td>
        </tr>
        <tr>
          <td>A13-A14</td>
          <td>0</td>
          <td>29</td>
          <td>749651949156483244</td>
        </tr>
        <tr>
          <td>A13-B14</td>
          <td>0</td>
          <td>75</td>
          <td>749651949156483244</td>
        </tr>
        <tr>
          <td>B14-A0</td>
          <td>-</td>
          <td>94</td>
          <td>749651949156483244</td>
        </tr>
        <tr>
          <td>A12-A13</td>
          <td>0</td>
          <td>29</td>
          <td>1499303898312966488</td>
        </tr>
        <tr>
          <td>A12-B13</td>
          <td>0</td>
          <td>75</td>
          <td>1499303898312966488</td>
        </tr>
        <tr>
          <td>B13-A0</td>
          <td>-</td>
          <td>105</td>
          <td>1499303898312966488</td>
        </tr>
        <tr>
          <td>A11-A12</td>
          <td>1</td>
          <td>29</td>
          <td>2998607796625932976</td>
        </tr>
        <tr>
          <td>A11-B12</td>
          <td>1</td>
          <td>75</td>
          <td>2998607796625932975</td>
        </tr>
        <tr>
          <td>B12-A0</td>
          <td>-</td>
          <td>116</td>
          <td>2998607796625932975</td>
        </tr>
        <tr>
          <td>A10-A11</td>
          <td>1</td>
          <td>29</td>
          <td>5997215593251865951</td>
        </tr>
        <tr>
          <td>A10-B11</td>
          <td>1</td>
          <td>75</td>
          <td>5997215593251865950</td>
        </tr>
        <tr>
          <td>B11-A0</td>
          <td>-</td>
          <td>127</td>
          <td>5997215593251865950</td>
        </tr>
        <tr>
          <td>A9-A10</td>
          <td>1</td>
          <td>29</td>
          <td>11994431186503731901</td>
        </tr>
        <tr>
          <td>A9-B10</td>
          <td>1</td>
          <td>75</td>
          <td>11994431186503731900</td>
        </tr>
        <tr>
          <td>B10-A0</td>
          <td>-</td>
          <td>138</td>
          <td>11994431186503731900</td>
        </tr>
        <tr>
          <td>A8'-A9</td>
          <td>0</td>
          <td>29</td>
          <td>23988862373007463801</td>
        </tr>
        <tr>
          <td>A8'-B9</td>
          <td>0</td>
          <td>75</td>
          <td>23988862373007463801</td>
        </tr>
        <tr>
          <td>B9-A0</td>
          <td>-</td>
          <td>149</td>
          <td>23988862373007463801</td>
        </tr>
        <tr>
          <td>A8-A8'</td>
          <td>-</td>
          <td>28</td>
          <td>47977724746014927602</td>
        </tr>
        <tr>
          <td>A7-A8</td>
          <td>0</td>
          <td>29</td>
          <td>47977724746014927602</td>
        </tr>
        <tr>
          <td>A7-B8</td>
          <td>0</td>
          <td>75</td>
          <td>47977724746014927602</td>
        </tr>
        <tr>
          <td>B8-A0</td>
          <td>-</td>
          <td>142</td>
          <td>47977724746014927602</td>
        </tr>
        <tr>
          <td>A6-A7</td>
          <td>0</td>
          <td>29</td>
          <td>95955449492029855204</td>
        </tr>
        <tr>
          <td>A6-B7</td>
          <td>0</td>
          <td>75</td>
          <td>95955449492029855204</td>
        </tr>
        <tr>
          <td>B7-A0</td>
          <td>-</td>
          <td>131</td>
          <td>95955449492029855204</td>
        </tr>
        <tr>
          <td>A5-A6</td>
          <td>1</td>
          <td>29</td>
          <td>191910898984059710408</td>
        </tr>
        <tr>
          <td>A5-B6</td>
          <td>1</td>
          <td>75</td>
          <td>191910898984059710407</td>
        </tr>
        <tr>
          <td>B6-A0</td>
          <td>-</td>
          <td>120</td>
          <td>191910898984059710407</td>
        </tr>
        <tr>
          <td>A4-A5</td>
          <td>0</td>
          <td>29</td>
          <td>383821797968119420815</td>
        </tr>
        <tr>
          <td>A4-B5</td>
          <td>0</td>
          <td>75</td>
          <td>383821797968119420815</td>
        </tr>
        <tr>
          <td>B5-A0</td>
          <td>-</td>
          <td>109</td>
          <td>383821797968119420815</td>
        </tr>
        <tr>
          <td>A3-A4</td>
          <td>1</td>
          <td>29</td>
          <td>767643595936238841630</td>
        </tr>
        <tr>
          <td>A3-B4</td>
          <td>1</td>
          <td>75</td>
          <td>767643595936238841629</td>
        </tr>
        <tr>
          <td>B4-A0</td>
          <td>-</td>
          <td>98</td>
          <td>767643595936238841629</td>
        </tr>
        <tr>
          <td>A2-A3</td>
          <td>0</td>
          <td>29</td>
          <td>1535287191872477683259</td>
        </tr>
        <tr>
          <td>A2-B3</td>
          <td>0</td>
          <td>75</td>
          <td>1535287191872477683259</td>
        </tr>
        <tr>
          <td>B3-A0</td>
          <td>-</td>
          <td>87</td>
          <td>1535287191872477683259</td>
        </tr>
        <tr>
          <td>A1-A2</td>
          <td>0</td>
          <td>29</td>
          <td>3070574383744955366518</td>
        </tr>
        <tr>
          <td>A1-B2</td>
          <td>0</td>
          <td>75</td>
          <td>3070574383744955366518</td>
        </tr>
        <tr>
          <td>B2-A0</td>
          <td>-</td>
          <td>76</td>
          <td>3070574383744955366518</td>
        </tr>
        <tr>
          <td>A0-A1</td>
          <td>0</td>
          <td>29</td>
          <td>6141148767489910733036</td>
        </tr>
        <tr>
          <td>A0-B1</td>
          <td>0</td>
          <td>75</td>
          <td>6141148767489910733036</td>
        </tr>
        <tr>
          <td>B1-A0</td>
          <td>-</td>
          <td>65</td>
          <td>6141148767489910733036</td>
        </tr>
      </tbody>
    </Table>
    <p>
      The total number of moves is 2210912041915111502011400, a multiple of 100
      as predicted in the winning message. If we include a leading 0, we can
      pair up the digits to get a number between 1 and 26, convert via A1Z26 to
      spell the message <Monospace>BUILD SOKOBAN</Monospace>. Upon submitting
      this answer, we are given a task, which is the next part of the puzzle.
    </p>
    <p>
      The debug message at the bottom of the source code is meant to help
      solvers debug their method of counting the number of moves by telling the
      players the exact number of moves to reach particular spots of the maze,
      and also confirms that the total number of moves should end in "00". The
      method shown above works "backwards", so the debugging messages will not
      be useful. An alternative method of counting is "forwards", by computing
      the number of moves required to go from point A to point C for each room,
      assuming that that and all previous rooms are in{' '}
      <Monospace>State 0</Monospace>, and computing that from the first room to
      the last recursively. The debugging messages could be useful for this
      method.
    </p>
    <h2>Build Sokoban Task</h2>
    <p>
      The task is to build a 20x20 Sokoban with only one box that can be solved
      in no less than 1000 moves. A naive method of making the player take a
      long windy path does not work - there are only 400 cells! Even if we
      managed to force the player to backtrack once, it would only require a
      maximum of 800 moves. Thus, any solution must require the player to
      backtrack multiple times.{' '}
    </p>
    <p>
      The trick is to design a room (gadget) with an entrance and exit, and
      require the player to push the box through the room. However, pushing the
      box into the entrance blocks it for the player itself, requiring the
      player to backtrack all the way to the back of the room to progress. Here
      is one possible gadget.
    </p>
    <p>
      <SheetableImage alt="" src={image7} title="" className="mx-auto" />
    </p>
    <p>
      By chaining many of these gadgets together, the player is required to
      backtrack multiple times - once for each gadget - easily reaching 1000
      moves. Here is an example that requires 3209 moves (can you beat this?).
    </p>
    <pre className="text-center">
      {`
...#####..###...##..
..........###.......
#.######..####.###..
..#...##.##..#.#O#.#
......#......#.#....
..##.##...#..#.#....
####.######.##.####.
...#..#..##.##.#....
......#......#.#.###
#.##..#..#...#.#....
#.######.#####.####.
..##...#.#####.#....
.......#.##..#.#.###
..###.#......#.#....
#####.#...#..#.####.
P..##..####.##..#...
.......###......#.##
#.###..###...#..#...
#*#####...#########.
#.......#...........`.trimStart()}
    </pre>

    <p>
      <SheetableImage alt="" src={image8} title="" className="mx-auto" />
    </p>
    <p>
      We are directly given the answer, <Answerize>I SEE DEAD PEOPLE</Answerize>
      , upon completion of the task.
    </p>
    <AuthorsNotes>
      <p>
        The exponential construction is inspired by{' '}
        <a href="https://www.cs.ru.nl/bachelors-theses/2018/Jan_Potma___4476360___An_exponential_construction_for_Sokoban.pdf">
          this paper by Jan Potma
        </a>
        . The construction in the puzzle is slightly more compact.
      </p>
      <p>
        The task is a variant of{' '}
        <a href="https://codeforces.com/gym/102391/problem/B">this problem</a>{' '}
        from a programming competition. In that problem, the box is 2x2 instead
        of 1x1. In both versions, the state of the Sokoban can be represented
        just by the position of the unique player and box, so there are at most
        N^2 states, where N is the number of cells. Therefore, any such solvable
        Sokoban is solvable in O(N^2) moves. This construction shows that
        indeed, the maximum possible number of moves is of the order Θ(N^2).
      </p>
    </AuthorsNotes>
  </Solution>
);

export default PuzzleSolution;
export const getServerSideProps = getPuzzleProps(SLUG);
